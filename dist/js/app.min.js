!function(){function e(e){var t=[];return e.split("_").filter(function(e,i){0==i?t.push(e.toLowerCase()):t.push(e[0].toUpperCase()+e.substr(1).toLowerCase())}),t.join("")}function t(){$("#chart-container").height($(window).height()-g.outerHeight()-10)}function i(e,i){var a=c.find("option:selected").text();w=anychart.data.table();var n,o=w.mapAs({value:1,open:1,high:2,low:3,close:4});x=anychart.stock();var r=x.plot(0);if(w.addData(k.data[a.toLowerCase()]),i){var l,s,d=[];n=r[k.chartType](o),n.name(a.toUpperCase()),r.yScale(k.scale);for(keyIndicator in k.indicators)l=keyIndicator,k.indicators.hasOwnProperty(keyIndicator)&&(d=k.indicators[keyIndicator].settings,d[0]=o),~l.toLowerCase().indexOf("stochastic")&&(l="stochastic"),k.indicators.hasOwnProperty(keyIndicator)&&(s=x.plot(k.indicators[keyIndicator].plotIndex),s[l].apply(s,d))}else n=r.line(o),n.name(a.toUpperCase());n.stroke("2px #64b5f6"),r.yAxis(1).orientation("right"),x.padding(10,50,20,50),x.scroller().line(o),x.selectRange("2004-11-14","2007-11-15"),x.container(e),x.draw(),rangePicker=anychart.ui.rangePicker(),rangePicker.render(x),rangeSelector=anychart.ui.rangeSelector(),rangeSelector.render(x),x.listen("chartDraw",function(){t(),setTimeout(function(){y.hide()},100)})}function a(){x&&(x.dispose(),x=null)}function n(){f.val()&&(f.val().length>1?f.find("option:selected").each(function(){$(this).text($(this).attr("data-abbr"))}):f.find("option:selected").each(function(){$(this).text($(this).attr("data-full-text"))}),f.selectpicker("refresh").closest(".bootstrap-select").find(".dropdown-menu.inner").find("span.text").each(function(e){$(this).text(f.find("option").eq(e).attr("data-full-text"))}))}function o(){var e,t,i,a=C.defaultSettings[C.name],n=0;$("#indicatorSettingsModalTitle").text(C.defaultSettings[C.name].overview.title),m.empty(),m.append('<div class="row"></div>');var o=m.find(".row");for(key in a)if(a.hasOwnProperty(key)&&"overview"!==key&&"plotIndex"!==key)if("string"==typeof a[key]){if(o.append(T),e=$("#indicatorFormGroup"),e.find("select").attr("id",key),e.find("label").attr("for",key).text(l(key)),t=!1,a.hasOwnProperty("smoothingType"))for(n=0;n<a.smoothingType.length;n++)if(a[key]==a.smoothingType[n]){t=!0;break}if(t)for(n=0;n<a.smoothingType.length;n++)i=$("<option></option>"),i.val(a.smoothingType[n].toLowerCase()),i.text(a.smoothingType[n].toUpperCase()),e.find("select").append(i);else for(n=0;n<C.seriesType.length;n++)i=$("<option></option>"),i.val(C.seriesType[n].toLowerCase()),i.text(l(C.seriesType[n])),e.find("select").append(i);e.removeAttr("id")}else"number"==typeof a[key]&&(o.append(S),e=$("#indicatorFormGroup"),e.find("input").attr("id",key),e.removeAttr("id").find("label").attr("for",key).text(l(key)));r(),m.find($("[class*='col-sm-']")).last().after('<div class="col-xs-12" id="overviewText"></div>'),m.find("#overviewText").append(C.defaultSettings[C.name].overview.description)}function r(){var e,t=m.find(".col-sm-4").length,i=m.find(".col-sm-4").last().index();if(3!==t){if(t>3)for(;t>3;)t-=3;for(e=12/t;t;)--t,m.find($("[class*='col-sm-']")).eq(i-t).removeClass("col-sm-4").addClass("col-sm-"+e)}}function l(e){var t="",i=[];return e.split(/(?=[A-Z])/).filter(function(e){1==e.length?t+=e:(t+=" ",t+=e)}),t=t.trim(),t=t[0].toUpperCase()+t.substr(1),t.split(" ").filter(function(e,a){1==e.length&&a!==t.split(" ").length-1?i.push(e+"-"):i.push(e)}),i.join(" ").replace(/-\s/,"-")}function s(){var e=C.defaultSettings[C.name];for(key in e)e.hasOwnProperty(key)&&"overview"!==key&&"plotIndex"!==key&&$("#"+key).val(e[key])}var c=$("#chartDataSelect"),d=$("#seriesTypeSelect"),p=$("#scaleTypeSelect"),f=$("#indicatorTypeSelect"),h=$("#indicatorSettingsModal"),v=$("#resetButton"),u=$("#addIndicatorButton"),g=$("#indicatorNavPanel"),m=$("#indicatorForm"),y=$("#loader"),k={};k.data={},k.chartType=d.val(),k.scale=p.val(),k.indicators={};var x,w,b="chart-container",C={name:"",plotIndex:0,defaultSettings:{},seriesType:["area","column","jumpLine","line","marker","spline","splineArea","stepArea","stepLine","stick"]},S='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><input type="number" class="form-control" id=""></div></div>',T='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><select class="form-control select show-tick" id=""></select></div></div>',I={createChart:i,removeChart:a};"file:"===window.location.protocol&&(y.hide(),$(".wrapper").hide(),$("#warning").modal({backdrop:"static",keyboard:!1})),$.get("indicators.xml",function(t){$(t).children().children().each(function(t,i){var a,n=$(i).context.tagName,o=$("<option></option>");o.attr({value:n,"data-abbr":$(this).find("abbreviation").text(),"data-full-text":$(this).find("title").text()}).text($(this).find("title").text()),$(this).find("plot_index").length&&o.attr("data-plot-index",+$(this).find("plot_index").text()),f.append(o),C.defaultSettings[n]={},$(i).find("defaults").children().each(function(){var t=e($(this)[0].tagName),i=$(this).text();if(isNaN(+i))try{i=JSON.parse(i)}catch(e){}else i=Number(i);C.defaultSettings[n][t]=i}),a=$(i).find("description")[0].outerHTML,a=a.replace(/<description>/g,"").replace(/<\/description>/g,""),a=a.replace(/<caption>/g,"<b>").replace(/<\/caption>/g,"</b>"),a=a.replace(/<text>/g,"<p>").replace(/<\/text>/g,"</p>"),a=a.replace(/<list>/g,"<ul>").replace(/<\/list>/g,"</ul>"),a=a.replace(/<listItem>/g,"<li>").replace(/<\/listItem>/g,"</li>"),C.defaultSettings[n].overview={},C.defaultSettings[n].overview.title=$(i).find("title").text(),C.defaultSettings[n].overview.description=a}),f.selectpicker()}),$(window).on("resize",t),anychart.onDocumentReady(function(){anychart.data.loadJsonFile(c.val(),function(e){k.data.msft=e,I.createChart(b)}),c.on("change",function(){var e=$(this).find("option:selected").text().toLowerCase();~Object.keys(k.data).indexOf(e)?(w.addData(k.data[e]),x.plot().getSeries(0).name(e.toUpperCase())):anychart.data.loadJsonFile($(this).val(),function(t){k.data[e]=t,w.addData(t),x.plot().getSeries(0).name(e.toUpperCase())})}),d.on("change",function(){var e=$(this).val();x.plot().getSeries(0).seriesType(e),k.chartType=e}),f.on("change",function(){if($(this).val()&&1===$(this).val().length&&n(),null===$(this).val()||$(this).val().length<Object.keys(k.indicators).length){if(I.removeChart(),null!==$(this).val())for(keyIndicator in k.indicators)~$(this).val().indexOf(keyIndicator)||delete k.indicators[keyIndicator];else k.indicators={};return void I.createChart(b,!0)}for(var e=0;e<$(this).val().length;e++)if(!~Object.keys(k.indicators).indexOf($(this).val()[e])){C.name=$(this).val()[e];break}C.plotIndex=$(this).find('option[value="'+C.name+'"]').data().plotIndex,0!==C.plotIndex&&(C.plotIndex=x.getPlotsCount()),o(),s(),h.modal("show"),g.find(".select.open").removeClass("open")}),p.on("change",function(){I.removeChart(),k.scale=$(this).val(),I.createChart(b,!0)}),h.on("hidden.bs.modal",function(){for(var e,t=0;t<f.val().length;t++)if(!~Object.keys(k.indicators).indexOf(f.val()[t])){e=f.val()[t];break}if(!e)return n(),!1;var i=f.find('[value="'+e+'"]').index();f.find('[value="'+e+'"]').removeAttr("selected"),f.prev(".dropdown-menu").find('li[data-original-index="'+i+'"]').removeClass("selected"),n()}),h.on("show.bs.modal",function(){m.find(".select").selectpicker()}),v.on("click",function(e){e.preventDefault(),I.removeChart(),k.indicators={},k.scale="linear",k.chartType="line",c.val("data/msft.json").selectpicker("refresh"),d.val("line").selectpicker("refresh"),f.val("").selectpicker("refresh"),p.val("linear").selectpicker("refresh"),I.createChart(b)}),u.on("click",function(){var e=w.mapAs({value:1,open:1,high:2,low:3,close:4}),t=Object.keys(C.defaultSettings[C.name]),i=[e],a=C.name;~a.toLowerCase().indexOf("stochastic")&&(a="stochastic");for(var n=0;n<t.length;n++)"smoothingType"!==t[n]&&i.push($("#"+t[n]).val());k.indicators[C.name]={},k.indicators[C.name].settings=i,k.indicators[C.name].plotIndex=C.plotIndex;var o=x.plot(C.plotIndex);o[a].apply(o,i),h.modal("hide")})})}();