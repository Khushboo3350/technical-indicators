!function(){function e(e,t){var a=s.find("option:selected").text();k=anychart.data.table();var i,n=k.mapAs({value:1,open:1,high:2,low:3,close:4});g=anychart.stock();var o=g.plot(0);if(k.addData(m.data[a.toLowerCase()]),t){var r,l,d=[];i=o[m.chartType](n),i.name(a.toUpperCase()),o.yScale(m.scale);for(keyIndicator in m.indicators)r=keyIndicator,m.indicators.hasOwnProperty(keyIndicator)&&(d=m.indicators[keyIndicator].settings,d[0]=n),~r.toLowerCase().indexOf("stochastic")&&(r="stochastic"),m.indicators.hasOwnProperty(keyIndicator)&&(l=g.plot(m.indicators[keyIndicator].plotIndex),l[r].apply(l,d),l.yAxis(1).orientation("right"))}else i=o.line(n),i.name(a.toUpperCase());i.stroke("2px #64b5f6"),o.yAxis(1).orientation("right"),g.padding(10,50,20,50),g.scroller().line(n),g.selectRange("2004-11-14","2007-11-15"),g.container(e),g.draw(),anychart.ui.rangePicker().render(g),anychart.ui.rangeSelector().render(g),g.listen("chartDraw",function(){setTimeout(function(){y.hide()},100)})}function t(){g&&(g.dispose(),g=null)}function a(){c.val()&&(c.val().length>1?c.find("option:selected").each(function(){$(this).text($(this).attr("data-abbr"))}):c.find("option:selected").each(function(){$(this).text($(this).attr("data-full-text"))}),c.selectpicker("refresh").closest(".bootstrap-select").find(".dropdown-menu.inner").find("span.text").each(function(e){$(this).text(c.find("option").eq(e).attr("data-full-text"))}))}function i(){var e,t,a,i=w.defaultSettings[w.name],r=0;$("#indicatorSettingsModalTitle").text(w.defaultSettings[w.name].overview.title),u.empty(),u.append('<div class="row"></div>');var s=u.find(".row");for(key in i)if(i.hasOwnProperty(key)&&"overview"!==key&&"plotIndex"!==key)if("string"==typeof i[key]){if(s.append(C),e=$("#indicatorFormGroup"),e.find("select").attr("id",key),e.find("label").attr("for",key).text(o(key)),t=!1,i.hasOwnProperty("smoothingType"))for(r=0;r<i.smoothingType.length;r++)if(i[key]==i.smoothingType[r]){t=!0;break}if(t)for(r=0;r<i.smoothingType.length;r++)a=$("<option></option>"),a.val(i.smoothingType[r].toLowerCase()),a.text(i.smoothingType[r].toUpperCase()),e.find("select").append(a);else for(r=0;r<w.seriesType.length;r++)a=$("<option></option>"),a.val(w.seriesType[r].toLowerCase()),a.text(o(w.seriesType[r])),e.find("select").append(a);e.removeAttr("id")}else"number"==typeof i[key]&&(s.append(b),e=$("#indicatorFormGroup"),e.find("input").attr("id",key),e.removeAttr("id").find("label").attr("for",key).text(o(key)));n(),u.find($("[class*='col-sm-']")).last().after('<div class="col-xs-12" id="overviewText"></div>'),u.find("#overviewText").append(w.defaultSettings[w.name].overview.description)}function n(){var e,t=u.find(".col-sm-4").length,a=u.find(".col-sm-4").last().index();if(3!==t){if(t>3)for(;t>3;)t-=3;for(e=12/t;t;)--t,u.find($("[class*='col-sm-']")).eq(a-t).removeClass("col-sm-4").addClass("col-sm-"+e)}}function o(e){var t="",a=[];return e.split(/(?=[A-Z])/).filter(function(e){1==e.length?t+=e:(t+=" ",t+=e)}),t=t.trim(),t=t[0].toUpperCase()+t.substr(1),t.split(" ").filter(function(e,i){1==e.length&&i!==t.split(" ").length-1?a.push(e+"-"):a.push(e)}),a.join(" ").replace(/-\s/,"-")}function r(){var e=w.defaultSettings[w.name];for(key in e)e.hasOwnProperty(key)&&"overview"!==key&&"plotIndex"!==key&&$("#"+key).val(e[key])}var s=$("#chartDataSelect"),l=$("#seriesTypeSelect"),d=$("#scaleTypeSelect"),c=$("#indicatorTypeSelect"),p=$("#indicatorSettingsModal"),f=$("#resetButton"),h=$("#addIndicatorButton"),v=$("#indicatorNavPanel"),u=$("#indicatorForm"),y=$("#loader"),m={};m.data={},m.chartType=l.val(),m.scale=d.val(),m.indicators={};var g,k,x="chart-container",w={name:"",plotIndex:0,defaultSettings:{},seriesType:["area","column","jumpLine","line","marker","spline","splineArea","stepArea","stepLine","stick"]},b='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><input type="number" class="form-control" id=""></div></div>',C='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><select class="form-control select show-tick" id=""></select></div></div>',I={createChart:e,removeChart:t};"file:"===window.location.protocol&&(y.hide(),$(".wrapper").hide(),$("#warning").modal({backdrop:"static",keyboard:!1})),$.get("indicators.xml",function(e){$(e).find("indicator").each(function(e,t){var a,i=$(this).attr("type"),n=$("<option></option>");n.attr({value:i,"data-abbr":$(this).find("abbreviation").text(),"data-full-text":$(this).find("title").text()}).text($(this).find("title").text()),$(this).find('[name="plotIndex"]').length&&n.attr("data-plot-index",$(this).find('[name="plotIndex"]').attr("value")),c.append(n),w.defaultSettings[i]={},$(t).find("defaults").children().each(function(){var e=$(this).attr("name"),t=$(this).attr("value");switch($(this).attr("type")){case"number":t=+t;break;case"array":t=JSON.parse(t)}w.defaultSettings[i][e]=t}),a=$(t).find("description").text(),w.defaultSettings[i].overview={},w.defaultSettings[i].overview.title=$(t).find("title").text(),w.defaultSettings[i].overview.description=a}),c.selectpicker()}),anychart.onDocumentReady(function(){anychart.data.loadJsonFile(s.val(),function(e){m.data.msft=e,I.createChart(x)}),s.on("change",function(){var e=$(this).find("option:selected").text().toLowerCase();~Object.keys(m.data).indexOf(e)?(k.addData(m.data[e]),g.plot().getSeries(0).name(e.toUpperCase())):anychart.data.loadJsonFile($(this).val(),function(t){m.data[e]=t,k.addData(t),g.plot().getSeries(0).name(e.toUpperCase())})}),l.on("change",function(){var e=$(this).val();g.plot().getSeries(0).seriesType(e),m.chartType=e}),c.on("change",function(){if($(this).val()&&1===$(this).val().length&&a(),null===$(this).val()||$(this).val().length<Object.keys(m.indicators).length){if(I.removeChart(),null!==$(this).val())for(keyIndicator in m.indicators)~$(this).val().indexOf(keyIndicator)||delete m.indicators[keyIndicator];else m.indicators={};return void I.createChart(x,!0)}for(var e=0;e<$(this).val().length;e++)if(!~Object.keys(m.indicators).indexOf($(this).val()[e])){w.name=$(this).val()[e];break}w.plotIndex=$(this).find('option[value="'+w.name+'"]').data().plotIndex,0!==w.plotIndex&&(w.plotIndex=g.getPlotsCount()),i(),r(),p.modal("show"),v.find(".select.open").removeClass("open")}),d.on("change",function(){I.removeChart(),m.scale=$(this).val(),I.createChart(x,!0)}),p.on("hidden.bs.modal",function(){for(var e,t=0;t<c.val().length;t++)if(!~Object.keys(m.indicators).indexOf(c.val()[t])){e=c.val()[t];break}if(!e)return a(),!1;var i=c.find('[value="'+e+'"]').index();c.find('[value="'+e+'"]').removeAttr("selected"),c.prev(".dropdown-menu").find('li[data-original-index="'+i+'"]').removeClass("selected"),a()}),p.on("show.bs.modal",function(){u.find(".select").selectpicker()}),f.on("click",function(e){e.preventDefault(),I.removeChart(),m.indicators={},m.scale="linear",m.chartType="line",s.val("data/msft.json").selectpicker("refresh"),l.val("line").selectpicker("refresh"),c.val("").selectpicker("refresh"),d.val("linear").selectpicker("refresh"),I.createChart(x)}),h.on("click",function(){var e=k.mapAs({value:1,open:1,high:2,low:3,close:4}),t=Object.keys(w.defaultSettings[w.name]),a=[e],i=w.name;~i.toLowerCase().indexOf("stochastic")&&(i="stochastic");for(var n=0;n<t.length;n++)"smoothingType"!==t[n]&&a.push($("#"+t[n]).val());m.indicators[w.name]={},m.indicators[w.name].settings=a,m.indicators[w.name].plotIndex=w.plotIndex;var o=g.plot(w.plotIndex);o[i].apply(o,a),o.yAxis(1).orientation("right"),p.modal("hide")})})}();