!function(){function e(){$("#chart-container").height($(window).height()-m.outerHeight()-10)}function t(e,t){var i=l.find("option:selected").text();k=anychart.data.table();var a,n=k.mapAs({value:1,open:1,high:2,low:3,close:4});g=anychart.stock();var r=g.plot(0);if(k.addData(u.data[i.toLowerCase()]),t){var o,s,d=[];a=r[u.chartType](n),a.name(i.toUpperCase()),r.yScale(u.scale);for(keyIndicator in u.indicators)o=keyIndicator,u.indicators.hasOwnProperty(keyIndicator)&&(d=u.indicators[keyIndicator].settings,d[0]=n),~o.toLowerCase().indexOf("stochastic")&&(o="stochastic"),u.indicators.hasOwnProperty(keyIndicator)&&(s=g.plot(u.indicators[keyIndicator].plotIndex),s[o].apply(s,d))}else a=r.line(n),a.name(i.toUpperCase());a.stroke("2px #64b5f6"),r.yAxis(1).orientation("right"),g.padding(10,50,20,50),g.scroller().line(n),g.selectRange("2004-11-14","2007-11-15"),g.container(e),g.draw(),rangePicker=anychart.ui.rangePicker(),rangePicker.render(g),rangeSelector=anychart.ui.rangeSelector(),rangeSelector.render(g),g.listen("chartDraw",function(){$("#loader").hide()})}function i(){g&&(g.dispose(),g=null)}function a(){p.val()&&(p.val().length>1?p.find("option:selected").each(function(){$(this).text($(this).attr("data-abbr"))}):p.find("option:selected").each(function(){$(this).text($(this).attr("data-full-text"))}),p.selectpicker("refresh").closest(".bootstrap-select").find(".dropdown-menu.inner").find("span.text").each(function(e){$(this).text(p.find("option").eq(e).attr("data-full-text"))}))}function n(){var e,t,i,a=w.defaultSettings[w.name],n=0;$("#indicatorSettingsModalTitle").text(w.defaultSettings[w.name].overview.title),v.empty(),v.append('<div class="row"></div>');var s=v.find(".row");for(key in a)if(a.hasOwnProperty(key)&&"overview"!==key)if("string"==typeof a[key]){if(s.append(x),e=$("#indicatorFormGroup"),e.find("select").attr("id",key),e.find("label").attr("for",key).text(o(key)),t=!1,a.hasOwnProperty("smoothingType"))for(n=0;n<a.smoothingType.length;n++)if(a[key]==a.smoothingType[n]){t=!0;break}if(t)for(n=0;n<a.smoothingType.length;n++)i=$("<option></option>"),i.val(a.smoothingType[n].toLowerCase()),i.text(a.smoothingType[n].toUpperCase()),e.find("select").append(i);else for(n=0;n<w.seriesType.length;n++)i=$("<option></option>"),i.val(w.seriesType[n].toLowerCase()),i.text(o(w.seriesType[n])),e.find("select").append(i);e.removeAttr("id")}else"number"==typeof a[key]&&(s.append(S),e=$("#indicatorFormGroup"),e.find("input").attr("id",key),e.removeAttr("id").find("label").attr("for",key).text(o(key)));r(),v.find($("[class*='col-sm-']")).last().after('<div class="col-xs-12" id="overviewText"></div>'),v.find("#overviewText").append(w.defaultSettings[w.name].overview.description)}function r(){var e,t=v.find(".col-sm-4").length,i=v.find(".col-sm-4").last().index();if(3!==t){if(t>3)for(;t>3;)t-=3;for(e=12/t;t;)--t,v.find($("[class*='col-sm-']")).eq(i-t).removeClass("col-sm-4").addClass("col-sm-"+e)}}function o(e){var t="",i=[];return e.split(/(?=[A-Z])/).filter(function(e){1==e.length?t+=e:(t+=" ",t+=e)}),t=t.trim(),t=t[0].toUpperCase()+t.substr(1),t.split(" ").filter(function(e,a){1==e.length&&a!==t.split(" ").length-1?i.push(e+"-"):i.push(e)}),i.join(" ").replace(/-\s/,"-")}function s(){var e=w.defaultSettings[w.name];for(key in e)e.hasOwnProperty(key)&&"overview"!==key&&$("#"+key).val(e[key])}var l=$("#chartDataSelect"),d=$("#seriesTypeSelect"),c=$("#scaleTypeSelect"),p=$("#indicatorTypeSelect"),f=$("#indicatorSettingsModal"),h=$("#resetButton"),y=$("#addIndicatorButton"),m=$("#indicatorNavPanel"),v=$("#indicatorForm"),u={};u.data={},u.chartType=d.val(),u.scale=c.val(),u.indicators={};var g,k,T="chart-container",w={name:"",plotIndex:0,defaultSettings:{ama:{period:20,fastPeriod:2,slowPeriod:30,seriesType:"line"},aroon:{period:20,upSeriesType:"line",downSeriesType:"line"},atr:{period:14,seriesType:"line"},bbands:{period:20,deviation:2,upperSeriesType:"line",lowerSeriesType:"line",middleSeriesType:"line"},bbandsB:{period:20,deviation:2,seriesType:"line"},bbandsWidth:{period:20,deviation:2,seriesType:"line"},ema:{period:20,seriesType:"line"},stochastic:{kPeriod:14,kMAPeriod:1,dPeriod:3,smoothingType:["sma","ema"],kMAType:"sma",dMAType:"sma",kSeriesType:"line",dSeriesType:"line"},fastStochastic:{kPeriod:20,kMAPeriod:10,dPeriod:3,smoothingType:["sma","ema"],kMAType:"sma",dMAType:"sma",kSeriesType:"line",dSeriesType:"line"},slowStochastic:{kPeriod:14,kMAPeriod:3,dPeriod:3,smoothingType:["sma","ema"],kMAType:"sma",dMAType:"sma",kSeriesType:"line",dSeriesType:"line"},kdj:{kPeriod:14,kMAPeriod:5,dPeriod:5,smoothingType:["sma","ema"],kMAType:"ema",dMAType:"ema",kMultiplier:-2,dMultiplier:3,kSeriesType:"line",dSeriesType:"line",jSeriesType:"line"},mma:{period:20,seriesType:"line"},macd:{fastPeriod:12,slowPeriod:26,signalPeriod:9,macdSeriesType:"line",signalSeriesType:"line",histogramSeriesType:"column"},roc:{period:20,seriesType:"line"},rsi:{period:14,seriesType:"line"},sma:{period:20,seriesType:"line"}},seriesType:["area","column","jumpLine","line","marker","spline","splineArea","stepArea","stepLine","stick"]},S='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><input type="number" class="form-control" id=""></div></div>',x='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><select class="form-control select show-tick" id=""></select></div></div>',b={createChart:t,removeChart:i};$.get("overview.xml",function(e){$(e).children().children().each(function(e,t){var i,a=$(t).context.tagName;i=$(t).find("description")[0].outerHTML,i=i.replace(/<description>/g,"").replace(/<\/description>/g,""),i=i.replace(/<caption>/g,"<b>").replace(/<\/caption>/g,"</b>"),i=i.replace(/<text>/g,"<p>").replace(/<\/text>/g,"</p>"),i=i.replace(/<list>/g,"<ul>").replace(/<\/list>/g,"</ul>"),i=i.replace(/<listItem>/g,"<li>").replace(/<\/listItem>/g,"</li>"),w.defaultSettings[a].overview={},w.defaultSettings[a].overview.title=$(t).find("title").text(),w.defaultSettings[a].overview.description=i})}),anychart.onDocumentReady(function(){e(),anychart.data.loadJsonFile(l.val(),function(e){u.data.msft=e,b.createChart(T)}),l.on("change",function(){var e=$(this).find("option:selected").text().toLowerCase();~Object.keys(u.data).indexOf(e)?(k.addData(u.data[e]),g.plot().getSeries(0).name(e.toUpperCase())):anychart.data.loadJsonFile($(this).val(),function(t){u.data[e]=t,k.addData(t),g.plot().getSeries(0).name(e.toUpperCase())})}),d.on("change",function(){var e=$(this).val();g.plot().getSeries(0).seriesType(e),u.chartType=e}),p.on("change",function(){if($(this).val()&&1===$(this).val().length&&a(),null===$(this).val()||$(this).val().length<Object.keys(u.indicators).length){if(b.removeChart(),null!==$(this).val())for(keyIndicator in u.indicators)~$(this).val().indexOf(keyIndicator)||delete u.indicators[keyIndicator];else u.indicators={};return void b.createChart(T,!0)}for(var e=0;e<$(this).val().length;e++)if(!~Object.keys(u.indicators).indexOf($(this).val()[e])){w.name=$(this).val()[e];break}w.plotIndex=$(this).find('option[value="'+w.name+'"]').data().plotIndex,n(),s(),f.modal("show"),m.find(".select.open").removeClass("open")}),c.on("change",function(){b.removeChart(),u.scale=$(this).val(),b.createChart(T,!0)}),f.on("hidden.bs.modal",function(){for(var e,t=0;t<p.val().length;t++)if(!~Object.keys(u.indicators).indexOf(p.val()[t])){e=p.val()[t];break}if(!e)return a(),!1;var i=p.find('[value="'+e+'"]').index();p.find('[value="'+e+'"]').removeAttr("selected"),p.prev(".dropdown-menu").find('li[data-original-index="'+i+'"]').removeClass("selected"),a()}),f.on("show.bs.modal",function(){v.find(".select").selectpicker()}),h.on("click",function(e){e.preventDefault(),b.removeChart(),u.indicators={},u.scale="linear",u.chartType="line",l.val("data/msft.json").selectpicker("refresh"),d.val("line").selectpicker("refresh"),p.val("").selectpicker("refresh"),c.val("linear").selectpicker("refresh"),b.createChart(T)}),y.on("click",function(){var e=k.mapAs({value:1,open:1,high:2,low:3,close:4}),t=Object.keys(w.defaultSettings[w.name]),i=[e],a=w.name;~a.toLowerCase().indexOf("stochastic")&&(a="stochastic");for(var n=0;n<t.length;n++)"smoothingType"!==t[n]&&i.push($("#"+t[n]).val());u.indicators[w.name]={},u.indicators[w.name].settings=i,u.indicators[w.name].plotIndex=w.plotIndex;var r=g.plot(w.plotIndex);r[a].apply(r,i),f.modal("hide")})}),$(window).on("resize",e)}();