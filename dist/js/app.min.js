!function(){function e(){$("#chart-container").height($(window).height()-u.outerHeight()-10)}function t(t,a){var i=l.find("option:selected").text();x=anychart.data.table();var n,o=x.mapAs({value:1,open:1,high:2,low:3,close:4});k=anychart.stock();var r=k.plot(0);if(x.addData(g.data[i.toLowerCase()]),a){var s,d,c=[];n=r[g.chartType](o),n.name(i.toUpperCase()),r.yScale(g.scale);for(keyIndicator in g.indicators)s=keyIndicator,g.indicators.hasOwnProperty(keyIndicator)&&(c=g.indicators[keyIndicator].settings,c[0]=o),~s.toLowerCase().indexOf("stochastic")&&(s="stochastic"),g.indicators.hasOwnProperty(keyIndicator)&&(d=k.plot(g.indicators[keyIndicator].plotIndex),d[s].apply(d,c),d.yAxis(1).orientation("right"))}else n=r.line(o),n.name(i.toUpperCase());n.stroke("2px #64b5f6"),r.yAxis(1).orientation("right"),k.padding(10,50,20,50),k.scroller().line(o),k.selectRange("2004-11-14","2007-11-15"),k.container(t),k.draw(),anychart.ui.rangePicker().render(k),anychart.ui.rangeSelector().render(k),k.listen("chartDraw",function(){e(),setTimeout(function(){m.hide()},100)})}function a(){k&&(k.dispose(),k=null)}function i(){p.val()&&(p.val().length>1?p.find("option:selected").each(function(){$(this).text($(this).attr("data-abbr"))}):p.find("option:selected").each(function(){$(this).text($(this).attr("data-full-text"))}),p.selectpicker("refresh").closest(".bootstrap-select").find(".dropdown-menu.inner").find("span.text").each(function(e){$(this).text(p.find("option").eq(e).attr("data-full-text"))}))}function n(){var e,t,a,i=b.defaultSettings[b.name],n=0;$("#indicatorSettingsModalTitle").text(b.defaultSettings[b.name].overview.title),y.empty(),y.append('<div class="row"></div>');var s=y.find(".row");for(key in i)if(i.hasOwnProperty(key)&&"overview"!==key&&"plotIndex"!==key)if("string"==typeof i[key]){if(s.append(I),e=$("#indicatorFormGroup"),e.find("select").attr("id",key),e.find("label").attr("for",key).text(r(key)),t=!1,i.hasOwnProperty("smoothingType"))for(n=0;n<i.smoothingType.length;n++)if(i[key]==i.smoothingType[n]){t=!0;break}if(t)for(n=0;n<i.smoothingType.length;n++)a=$("<option></option>"),a.val(i.smoothingType[n].toLowerCase()),a.text(i.smoothingType[n].toUpperCase()),e.find("select").append(a);else for(n=0;n<b.seriesType.length;n++)a=$("<option></option>"),a.val(b.seriesType[n].toLowerCase()),a.text(r(b.seriesType[n])),e.find("select").append(a);e.removeAttr("id")}else"number"==typeof i[key]&&(s.append(C),e=$("#indicatorFormGroup"),e.find("input").attr("id",key),e.removeAttr("id").find("label").attr("for",key).text(r(key)));o(),y.find($("[class*='col-sm-']")).last().after('<div class="col-xs-12" id="overviewText"></div>'),y.find("#overviewText").append(b.defaultSettings[b.name].overview.description)}function o(){var e,t=y.find(".col-sm-4").length,a=y.find(".col-sm-4").last().index();if(3!==t){if(t>3)for(;t>3;)t-=3;for(e=12/t;t;)--t,y.find($("[class*='col-sm-']")).eq(a-t).removeClass("col-sm-4").addClass("col-sm-"+e)}}function r(e){var t="",a=[];return e.split(/(?=[A-Z])/).filter(function(e){1==e.length?t+=e:(t+=" ",t+=e)}),t=t.trim(),t=t[0].toUpperCase()+t.substr(1),t.split(" ").filter(function(e,i){1==e.length&&i!==t.split(" ").length-1?a.push(e+"-"):a.push(e)}),a.join(" ").replace(/-\s/,"-")}function s(){var e=b.defaultSettings[b.name];for(key in e)e.hasOwnProperty(key)&&"overview"!==key&&"plotIndex"!==key&&$("#"+key).val(e[key])}var l=$("#chartDataSelect"),d=$("#seriesTypeSelect"),c=$("#scaleTypeSelect"),p=$("#indicatorTypeSelect"),f=$("#indicatorSettingsModal"),h=$("#resetButton"),v=$("#addIndicatorButton"),u=$("#indicatorNavPanel"),y=$("#indicatorForm"),m=$("#loader"),g={};g.data={},g.chartType=d.val(),g.scale=c.val(),g.indicators={};var k,x,w="chart-container",b={name:"",plotIndex:0,defaultSettings:{},seriesType:["area","column","jumpLine","line","marker","spline","splineArea","stepArea","stepLine","stick"]},C='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><input type="number" class="form-control" id=""></div></div>',I='<div class="col-sm-4"><div class="form-group" id="indicatorFormGroup"><label for="" class="control-label"></label><select class="form-control select show-tick" id=""></select></div></div>',S={createChart:t,removeChart:a};"file:"===window.location.protocol&&(m.hide(),$(".wrapper").hide(),$("#warning").modal({backdrop:"static",keyboard:!1})),$.get("indicators.xml",function(e){$(e).find("indicator").each(function(e,t){var a,i=$(this).attr("type"),n=$("<option></option>");n.attr({value:i,"data-abbr":$(this).find("abbreviation").text(),"data-full-text":$(this).find("title").text()}).text($(this).find("title").text()),$(this).find('[name="plotIndex"]').length&&n.attr("data-plot-index",$(this).find('[name="plotIndex"]').attr("value")),p.append(n),b.defaultSettings[i]={},$(t).find("defaults").children().each(function(){var e=$(this).attr("name"),t=$(this).attr("value");switch($(this).attr("type")){case"number":t=+t;break;case"array":t=JSON.parse(t)}b.defaultSettings[i][e]=t}),a=$(t).find("description").text(),b.defaultSettings[i].overview={},b.defaultSettings[i].overview.title=$(t).find("title").text(),b.defaultSettings[i].overview.description=a}),p.selectpicker()}),$(window).on("resize",e),anychart.onDocumentReady(function(){anychart.data.loadJsonFile(l.val(),function(e){g.data.msft=e,S.createChart(w)}),l.on("change",function(){var e=$(this).find("option:selected").text().toLowerCase();~Object.keys(g.data).indexOf(e)?(x.addData(g.data[e]),k.plot().getSeries(0).name(e.toUpperCase())):anychart.data.loadJsonFile($(this).val(),function(t){g.data[e]=t,x.addData(t),k.plot().getSeries(0).name(e.toUpperCase())})}),d.on("change",function(){var e=$(this).val();k.plot().getSeries(0).seriesType(e),g.chartType=e}),p.on("change",function(){if($(this).val()&&1===$(this).val().length&&i(),null===$(this).val()||$(this).val().length<Object.keys(g.indicators).length){if(S.removeChart(),null!==$(this).val())for(keyIndicator in g.indicators)~$(this).val().indexOf(keyIndicator)||delete g.indicators[keyIndicator];else g.indicators={};return void S.createChart(w,!0)}for(var e=0;e<$(this).val().length;e++)if(!~Object.keys(g.indicators).indexOf($(this).val()[e])){b.name=$(this).val()[e];break}b.plotIndex=$(this).find('option[value="'+b.name+'"]').data().plotIndex,0!==b.plotIndex&&(b.plotIndex=k.getPlotsCount()),n(),s(),f.modal("show"),u.find(".select.open").removeClass("open")}),c.on("change",function(){S.removeChart(),g.scale=$(this).val(),S.createChart(w,!0)}),f.on("hidden.bs.modal",function(){for(var e,t=0;t<p.val().length;t++)if(!~Object.keys(g.indicators).indexOf(p.val()[t])){e=p.val()[t];break}if(!e)return i(),!1;var a=p.find('[value="'+e+'"]').index();p.find('[value="'+e+'"]').removeAttr("selected"),p.prev(".dropdown-menu").find('li[data-original-index="'+a+'"]').removeClass("selected"),i()}),f.on("show.bs.modal",function(){y.find(".select").selectpicker()}),h.on("click",function(e){e.preventDefault(),S.removeChart(),g.indicators={},g.scale="linear",g.chartType="line",l.val("data/msft.json").selectpicker("refresh"),d.val("line").selectpicker("refresh"),p.val("").selectpicker("refresh"),c.val("linear").selectpicker("refresh"),S.createChart(w)}),v.on("click",function(){var e=x.mapAs({value:1,open:1,high:2,low:3,close:4}),t=Object.keys(b.defaultSettings[b.name]),a=[e],i=b.name;~i.toLowerCase().indexOf("stochastic")&&(i="stochastic");for(var n=0;n<t.length;n++)"smoothingType"!==t[n]&&a.push($("#"+t[n]).val());g.indicators[b.name]={},g.indicators[b.name].settings=a,g.indicators[b.name].plotIndex=b.plotIndex;var o=k.plot(b.plotIndex);o[i].apply(o,a),o.yAxis(1).orientation("right"),f.modal("hide")})})}();